---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
`%>%` <- magrittr::`%>%`
library(ggplot2)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# AnaliseCOVID19Brasil

<!-- badges: start -->
<!-- badges: end -->

O objetivo do pacote AnaliseCOVID19Brasil é o de prover análises práticas e atualizadas, incluindo alguns gráficos, além de ser o meu trabalho de conclusão do curso R para Ciência de Dados 2 da [Curso-R](https://www.curso-r.com/).

Aí você pode se perguntar...

Se tantos pacotes já fazem análises de dados da COVID-19, por que usar este aqui ~~e não algum outro~~?

Meu primeiro enfoque foi o de fazer um pacote que permita, *de maneira muito simples*, **atualizar** os dados da pandemia no Brasil **antes** de proceder às análises. Em outras palavras, toda a dinâmica da pandemia no Brasil vai se revelando conforme este pacote é utilizado ao longo do tempo.

***

## Instalação

Você pode instalar o AnaliseCOVID19Brasil do [GitHub](https://github.com/) com:

``` r
# install.packages("devtools")
devtools::install_github("brunocp76/AnaliseCOVID19Brasil")
```
## Utilização - Atualização de Dados

Como disse, os primeiros propósitos deste pacotes são ser simples do usuário utilizar e poder atualizar os dados antes de proceder à qualquer análise. Então começamos assim:

```{r Carregando a biblioteca e atualizando os dados, warning=FALSE}
library(AnaliseCOVID19Brasil)

atualiza_dados()
```

A função `atualiza_dados()` é uma das funções principais, pois aciona uma série de funções menores, cada uma fazendo uma parte do processo de obter pela internet os dados mais atualizados de fontes diferentes e de combinar todos eles em uma única base.

Desta forma, depois de executada esta função você terá a base `covid` construída com dados atualizados disponíveis tanto no portal [Brasil.io](https://brasil.io/) quanto no [Ministério da Saúde](https://covid.saude.gov.br/)

***

## Utilização - Agregações de Dados

```{r Organizando a informação atualizada em diversos níveis para análise, warning=FALSE}
bases_derivadas()
```

A função `bases_derivadas()` é outra das funções principais, pois parte da base `covid` e gera funções com os dados para análise (os dados originais e mais alguns dados derivados) em 5 níveis distintos de agregação (de município a Brasil inteiro), para viabilizar a análise nestes níveis.

Então após executar esta função você terá as bases derivadas com os dados sumarizados em 5 níveis crescentes de agregação:

Segue a relação de bases disponíveis:

- `covid`
    - A base atualizada "original".

- `covid_cidades`
    - Dados agregados ao nível de municípios. Embora seja estruturalmente similar à base `covid`, esta base e as seguintes possuem mais alguns indicadores derivados para análise.

- `covid_regioes_saude`
    - Dados agregados ao nível de regiões de saúde (regiões intraestaduais de gestão de saúde).

- `covid_estados`
    - Dados agregados ao nível de estados.

- `covid_regioes_brasil`
    - Dados agregados ao nível de regiões políticas do Brasil.

- `covid_brasil`
    - Dados agregados ao nível do Brasil.

***

## Análises Gráficas

Com os dados atualizados e organizados, podemos fazer as primeiras observações:

### Contágio

```{r Maiores Contágios nos Estados, echo = F, warning = F, message = F, fig.align = "center", fig.width = 11, fig.height = 6, fig.cap = "Gráfico 01 - Animação dos 5 estados com maiores volumes de Contágio pela Pandemia"}
covid_estados %>%
   dplyr::group_by(uf, date) %>%
   dplyr::summarise(contagios_acumulados = sum(contagios_acumulados)) %>%
   dplyr::mutate(num_contagios = max(contagios_acumulados)) %>%
   dplyr::ungroup() %>%
   dplyr::mutate(
      limite = num_contagios %>%
         unique() %>%
         sort(decreasing = TRUE) %>%
         dplyr::nth(5)
   ) %>%
   dplyr::filter(num_contagios >= limite) %>%
   ggplot2::ggplot(ggplot2::aes(y = contagios_acumulados, x = date, color = uf)) +
   ggplot2::labs(
      x = "Data",
      y = "Contágios Acumulados",
      title = "Contágios Acumulados",
      subtitle = "Nos estados com os 5 maiores volumes"
   ) +
   ggplot2::geom_line(show.legend = FALSE) +
   ggplot2::scale_x_date(date_breaks = "1 month", date_labels = "%m/%Y") +
   ggplot2::geom_label(ggplot2::aes(label = uf), show.legend = FALSE) +
   tema_bruno() +
   gganimate::transition_reveal(date)
```


### Óbitos

```{r Maiores Óbitos nos Estados, echo = F, warning = F, message = F, fig.align = "center", fig.width = 11, fig.height = 6, fig.cap = "Gráfico 02 - Animação dos 5 estados com maiores volumes de Óbitos pela Pandemia"}
covid_estados %>%
   dplyr::group_by(uf, date) %>%
   dplyr::summarise(obitos_acumulados = sum(obitos_acumulados)) %>%
   dplyr::mutate(num_obitos = max(obitos_acumulados)) %>%
   dplyr::ungroup() %>%
   dplyr::mutate(
      limite = num_obitos %>%
         unique() %>%
         sort(decreasing = TRUE) %>%
         dplyr::nth(5)
   ) %>%
   dplyr::filter(num_obitos >= limite) %>%
   ggplot2::ggplot(ggplot2::aes(y = obitos_acumulados, x = date, color = uf)) +
   ggplot2::labs(
      x = "Data",
      y = "Óbitos Acumulados",
      title = "Óbitos Acumulados",
      subtitle = "Nos estados com os 5 maiores volumes"
   ) +
   ggplot2::geom_line(show.legend = FALSE) +
   ggplot2::scale_x_date(date_breaks = "1 month", date_labels = "%m/%Y") +
   ggplot2::geom_label(ggplot2::aes(label = uf), show.legend = FALSE) +
   tema_bruno() +
   gganimate::transition_reveal(date)
```

De certa forma, era esperado que os estados com maior população tivessem os maiores volumes tanto de contágios quanto de óbitos.

Para isso eu construí uma série de indicadores ditos normalizados, tais como volumes de contágios e óbitos por grupo de 100 mil habitantes.

Mas antes disso, pensemos na pergunta sobre se a pandemia está arrefecendo ou não... Vejamos os volumes de contágios e óbitos novos diários, com o já conhecido ajuste de média móvel.

```{r Volumes Diários de Contágios, echo = F, warning = F, message = F, fig.align = "center", fig.width = 11, fig.height = 6, fig.cap = "Gráfico 03 - Volumes Diários de Novos Contágios no Brasil"}
covid_brasil %>%
   ggplot2::ggplot() +
   ggplot2::geom_col(ggplot2::aes(x = date, y = contagios_novos, fill = contagios_novos), color = "cyan", show.legend = FALSE) +
   ggplot2::geom_line(ggplot2::aes(x = date, y = contagios_novos_mm7), color = "yellow", size = 1L) +
   ggplot2::scale_x_date(date_breaks = "1 month", date_labels = "%m/%Y") +
   tema_bruno() +
   ggplot2::labs(
      x = "Data",
      y = "Novos Contágios",
      title = "Volumes Diários de Novos Contágios",
      subtitle = "Em todo o Brasil"
   )
```

```{r Volumes Diários de Óbitos, echo = F, warning = F, message = F, fig.align = "center", fig.width = 11, fig.height = 6, fig.cap = "Gráfico 04 - Volumes Diários de Novos Óbitos no Brasil"}
covid_brasil %>%
   ggplot2::ggplot() +
   ggplot2::geom_col(ggplot2::aes(x = date, y = obitos_novos, fill = obitos_novos), color = "cyan", show.legend = FALSE) +
   ggplot2::geom_line(ggplot2::aes(x = date, y = obitos_novos_mm7), color = "yellow", size = 1L) +
   ggplot2::scale_x_date(date_breaks = "1 month", date_labels = "%m/%Y") +
   tema_bruno() +
   ggplot2::labs(
      x = "Data",
      y = "Novos Óbitos",
      title = "Volumes Diários de Novos Óbitos",
      subtitle = "Em todo o Brasil"
   )
```

